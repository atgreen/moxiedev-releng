machine:
  services:
    - docker

checkout:
  post:
    - git submodule sync
    - git submodule update --init

dependencies:
  override:
    - docker build -t moxielogic/moxiedev-builder-el7 .
    - docker run -t -v `pwd`:/opt moxielogic/moxiedev-builder-el7
    - find /root/rpmbuild -name \*.rpm | xargs -n 1 -I RPMFILE cp RPMFILE $CIRCLE_ARTIFACTS
    - rm -rf dist
    - docker build -t moxielogic/moxiedev-builder-f24 .
    - docker run -t -v `pwd`:/opt moxielogic/moxiedev-builder-f24
    - find /root/rpmbuild -name \*.rpm | xargs -n 1 -I RPMFILE cp RPMFILE $CIRCLE_ARTIFACTS
    - rm -rf dist
