machine:
  services:
    - docker

checkout:
  post:
    - git submodule sync
    - git submodule update --init

dependencies:
  override:
    - docker build -f Dockerfile.f24 -t moxielogic/moxiedev-builder-f24 .
    - docker run -t -v `pwd`:/opt moxielogic/moxiedev-builder-f24
    - cp build-f24.log $CIRCLE_ARTIFACTS
    - find rpms -name \*.rpm | xargs -n 1 -I RPMFILE cp RPMFILE $CIRCLE_ARTIFACTS
    - docker build -f Dockerfile.el7 -t moxielogic/moxiedev-builder-el7 .
    - docker run -t -v `pwd`:/opt moxielogic/moxiedev-builder-el7
    - find rpms -name \*.rpm | xargs -n 1 -I RPMFILE cp RPMFILE $CIRCLE_ARTIFACTS
    - cp build-el7.log $CIRCLE_ARTIFACTS
